# mdb-query-scale
Run some basic queries while the collection grows to test the scalability of MongoDB queries. In OLTP, the response time must be proportional to the result, not to the size of the database.

Example:
```

[mlab data]# npm install @faker-js/faker

[mlab data]# mongosh -f orders.js

Creating customers...
Inserted 10000 customers.
Creating products...
Inserted 10000 products.
Creating stores...
Inserted 10000 stores.
Creating indexes...
Indexes created.
Inserting batch 1 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 1. Elapsed time: 18804 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:        50000, Query 1:      3 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 2 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 2. Elapsed time: 25883 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       100000, Query 1:      3 ms, Query 2:      3 ms, Query 3:      1 ms
Inserting batch 3 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 3. Elapsed time: 19608 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       150000, Query 1:     14 ms, Query 2:      8 ms, Query 3:      5 ms
Inserting batch 4 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 4. Elapsed time: 23202 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       200000, Query 1:     12 ms, Query 2:      7 ms, Query 3:      3 ms
Inserting batch 5 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 5. Elapsed time: 26995 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       250000, Query 1:      4 ms, Query 2:      7 ms, Query 3:      5 ms
Inserting batch 6 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 6. Elapsed time: 20630 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       300000, Query 1:      4 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 7 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 7. Elapsed time: 22000 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       350000, Query 1:      8 ms, Query 2:      6 ms, Query 3:      3 ms
Inserting batch 8 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 8. Elapsed time: 31208 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       400000, Query 1:      4 ms, Query 2:      3 ms, Query 3:      1 ms
Inserting batch 9 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 9. Elapsed time: 21480 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       450000, Query 1:     12 ms, Query 2:      7 ms, Query 3:      3 ms
Inserting batch 10 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 10. Elapsed time: 20617 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       500000, Query 1:      3 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 11 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 11. Elapsed time: 31437 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       550000, Query 1:      5 ms, Query 2:      7 ms, Query 3:      3 ms
Inserting batch 12 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 12. Elapsed time: 23261 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       600000, Query 1:      4 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 13 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 13. Elapsed time: 33647 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       650000, Query 1:      4 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 14 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 14. Elapsed time: 21941 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       700000, Query 1:      4 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 15 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 15. Elapsed time: 24361 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       750000, Query 1:      3 ms, Query 2:      5 ms, Query 3:      2 ms
Inserting batch 16 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 16. Elapsed time: 21567 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       800000, Query 1:     17 ms, Query 2:      6 ms, Query 3:      3 ms
Inserting batch 17 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 17. Elapsed time: 29607 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       850000, Query 1:      4 ms, Query 2:      4 ms, Query 3:      2 ms
Inserting batch 18 of orders...
Creating orders...
Inserted 50000 orders.
Finished batch 18. Elapsed time: 23377 ms
Running some queries...
Running Query 1: Find last order by customer email
Running Query 2: Find last delivered orders for some products
Running Query 3: Estimated count of orders
=== Queries response time  === Total documents:       900000, Query 1:      3 ms, Query 2:      3 ms, Query 3:      2 ms
```

As the collection size increases, the response time of the queries remains consistent. This validates that the indexes are correctly addressing the query access patterns.

If you run it on other databases that claim MongoDB compatibility, please share the result (create an issue). Examples: Amazon DocumentDB, Azure CosmosDB, Oracle ORDS, FerretDB, Percona, Google Firestore.
